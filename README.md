# 爱信智慧医疗 - CentralServer

## 技术说明

### 技术架构

* Spring Boot - 2.3.0-RELEASE+
* MySQL - 8.0+
* Netty - 4.1+

### 开发/生产环境

* Ubuntu 18.04 x86_64
  * CPU: 2+
  * RAM: 4GB+
  * ROM: 500GB+
  * Network: 100Mbps+
* Java: 1.8.121+
* MySQL: 8.0+


## 开发说明

### MybatisPlus使用说明

* 在指定 `model` 文件夹下创建实体类，可自动映射
* Dao层 `XxxDao` 可继承 `com.baomidou.mybatisplus.core.mapper.BaseMapper` 接口，无需再手写基础的增删改查方法
* 支持逻辑删除，详见[官方文档](https://mp.baomidou.com/guide/logic-delete.html)
* 支持枚举映射: 在配置文件指定包下创建的枚举类中对自定义属性使用 `com.baomidou.mybatisplus.annotation.EnumValue` 注解，可自动完成与数据库值的映射
* 支持单表分页，详见[官方文档](https://mp.baomidou.com/guide/page.html)

### JSON API

#### HTTP响应

响应对象可继承 `com.hankutech.ax.centralserver.support.base.BaseResponse`，统一响应格式：

```json
{
  "status": "FAILURE",
  "errorCode": 100001,
  "data": {},
  "message": "对一些错误信息进行补充说明"
}
```

其中：
* status: 响应数据状态，暂时包括：SUCCESS，FAILURE，UNAUTHORIZED 和 DENIED 四种
* errorCode: 用来统一定位错误原因，详见[统一错误码列表](#统一错误码列表)
* data: 实际要传输的数据
* message: 状态或错误的补充说明

### 统一错误码列表

* 系统错误

错误码 | 说明
--- | ---
100001 | 系统内部错误


## 业务说明

### 与爱信的socket通信协议

#### 通信方式

* socket通信：

```
               socket                              socket
艾信控制器 <--------------> 中心控制器（本系统） <--------------> 算法终端
```

* 端口号范围：`4000 ~ 5000`
* 数据格式：`Byte`

#### 艾信控制器

艾信控制器参数由状态参数和控制参数组成，总长度为 **10** 字节

* 状态参数 - 2字节
  * 第一个字节 X1 标示艾信控制器系统状态，`5` 标示停止，`8` 标示运行
  * 第二个字节 X2 备用，0 占位
* 控制参数 - 8字节
  * 第三个字节 X3 标示第一组摄像头的编号，范围 1-255
  * 第四个字节 X4 标示第二组摄像头的编号，范围 1-255(实际对应 256-510)
  * 第五个字节 X5 标示备用，0 占位
  * 第六个字节 X6 标示备用，0 占位
  * 第七个字节 X7 标示备用，0 占位
  * 第八个字节 X8 标示备用，0 占位
  * 第九个字节 X9 标示场景应用，`1` 标示中型物流护士站点，`2` 标示气力式垃圾站点投递口
  * 第十个字节 X10 标示任务类型，范围 1-4
    * `1` 标示安全防护检测和周转箱颜色检测任务
    * `2` 标示人脸识别检测任务
    * `3` 标示垃圾分类检测任务
    * `4` 标示有无人员检测任务
    
#### 算法终端

当艾信控制器状态为待机状态，算法终端需要实时检测 AI 识别任务，并把数据保存在本
地寄存器，等艾信控制器任务请求时发出

视频智能算法控制器参数由状态参数和控制参数组成，总长度为 **10** 字节

* 状态参数 - 2字节
  * 第一个字节 X1 标示艾信控制器系统状态，`5` 标示停止，`8` 标示运行
  * 第二个字节 X2 备用，0 占位
* 控制参数 - 8字节
  * 第三个字节 X3 标示第一组摄像头的编号，范围 1-255
  * 第四个字节 X4 标示第二组摄像头的编号，范围 1-255(实际对应 256-510)
  * 第五个字节 X5 标示备用，0 占位
  * 第六个字节 X6 标示备用，0 占位
  * 第七个字节 X7 标示备用，0 占位
  * 第八个字节 X8 标示场景应用，`1` 标示中型物流护士站点，`2` 标示气力式垃圾站点投递口
  * 第九个字节 X9 标示任务类型，范围 1-4
    * `1` 标示安全防护检测和周转箱颜色检测任务
    * `2` 标示人脸识别检测任务
    * `3` 标示垃圾分类检测任务
    * `4` 标示有无人员检测任务
  * 第十个字节 X10 标示对应任务的检测结果
    * 任务1
      * `1` 标示周转箱未盖盖子
      * `2` 标示非专用周转箱
      * `3` 标示有人误触发
      * `81` 标示绿色周转箱无异常
      * `82` 标示蓝色周转箱无异常
      * `83` 标示灰色周转箱无异常
      * `84` 标示红色周转箱无异常
    * 任务2
      * `1` 标示 1 号人员通过识别，以此类推2号，3号...
      * `99` 标示识别异常
    * 任务3
      * `1` 标示干垃圾（灰色垃圾袋）
      * `2` 标示湿垃圾（黑色垃圾袋）
      * `3` 标示可回收垃圾（绿色垃圾袋）
      * `4` 标示有害垃圾（红色垃圾袋）
      * `99` 标示异常
    * 任务4
      * `1` 标示有人
      * `2` 没人
      * `99` 异常





